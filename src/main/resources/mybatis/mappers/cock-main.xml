<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cockMain">
	
	<select id="selectLatestRest" resultType="MainVO">
		SELECT r.rid, lat, lng, name, i.path AS img, GROUP_CONCAT(distinct t.tag) AS tags, COUNT(distinct a.article_id) AS count, a.write_dt	
		  FROM cc_rest r
		  LEFT JOIN cc_article a
			ON r.rid = a.rid 
		  LEFT JOIN cc_img i
			ON a.rid = i.rid
		  LEFT JOIN cc_tag t
		    ON r.rid = t.rid		  
		 GROUP BY rid
		 ORDER BY a.write_dt DESC
	</select>
	
	<select id="selectArticleRest" resultType="MainVO">
		SELECT r.rid, lat, lng, name, i.path AS img, GROUP_CONCAT(distinct t.tag) AS tags, COUNT(distinct a.article_id) AS count, a.write_dt	
		  FROM cc_rest r
		  LEFT JOIN cc_article a
			ON r.rid = a.rid 
		  LEFT JOIN cc_img i
			ON a.rid = i.rid
		  LEFT JOIN cc_tag t
		    ON r.rid = t.rid		  
		 GROUP BY rid
		 ORDER BY count DESC
	</select>
	
	<select id="selectTags" resultType="tagVO">
		SELECT rid, GROUP_CONCAT(distinct tag) AS tag
		  FROM cc_tag
		 GROUP BY rid
	</select>
	
	<select id="selectTopFour" resultType="TopFourVO">
		SELECT t.*, @rowNum := @rownum + 1 as rank
		  FROM (SELECT r.rid, name, i.path AS img, COUNT(distinct a.article_id) AS count
				  FROM cc_rest r
				  LEFT JOIN cc_img i
					ON r.rid = i.rid
				  LEFT JOIN cc_article a
					ON r.rid = a.rid
				 GROUP BY rid
				 ORDER BY count DESC
				 LIMIT 4) t, (SELECT @rownum := 0) r;
	</select>	
	
</mapper>